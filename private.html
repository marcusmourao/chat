<!doctype html>
<html>
<head>
    <title>Redes 2016 - Chat Messenger</title>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col s8 m8 l8">
            <ul id="messages"></ul>
        </div>
        <div class="col s4 m4 l4">
            <table class="centered striped bordered">
                <thead>
                <tr>
                    <th> Usuários Online </th>
                </tr>
                </thead>
                <tbody id="users">

                </tbody>

            </table>
        </div>
    </div>
</div>
<form action="" method="post">
    <div class="container">
        <div class="row">
            <div class="input-field">
                <input class="bottom" id="m" autocomplete="off" />
            </div>
        </div>
        <div class="row">
            <div class="col s6 m6 l6">
                <a class="left" href="/private">Criar chat privado</a>
                <a class="left" href="/private">Entrar em sala privada</a>
            </div>
        </div>
    </div>
</form>
<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script>
    var socket = io(); //cliente

    $('form').submit(function(){
        socket.emit('chat message', $('#m').val()); // emite o evento de envio de mensagem
        $('#m').val('');                            // limpa o conteúdo da caixa de texto
        return false;
    });

    function privateRoom(){
        console.log("teste");
    }

    socket.on('chat message', function(msg, user){
        $('#messages').append($('<li>').text(user + " diz: " + msg)); // Ao receber uma mensagem atualiza a tela
    });


    socket.on('leave chat', function(msg){
        $('#messages').append($('<li class="red-text">').text(msg)); // Ao receber um evento de saída avisa os demais usuários
    });


    socket.on('conect', function(username, user){
        $('#messages').append($('<li class="green-text">').text(user + " entrou na sala")); // Ao receber um evento de entrada avisa todos os usuários
        $("#users").empty();
        for(var i=0; i< username.length; i++)
            $('#users').append("<tr><td onclick='privateRoom()'> " + username[i] + "</td></tr>"); // Atualiza a lista de usuários onlines
    });

    socket.on('update', function(username){
        $("#users").empty();
        for(var i=0; i< username.length; i++)
            $('#users').append("<tr><td onclick='privateRoom()'>" + username[i] + "</td></tr>"); // Atualiza a lista de usuários onlines
    });
</script>
</body>
</html>